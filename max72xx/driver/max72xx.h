/*
 * max72xx.h
 *
 *  Created on: 11 марта 2015 г.
 *      Author: nikolayba
 */

#ifndef DRIVER_MAX72XX_H_
#define DRIVER_MAX72XX_H_

//Opcodes for the MAX7221 and MAX7219
#define MAX72XX_NOOP        0x00
#define MAX72XX_D0      	0x01
#define MAX72XX_D1      	0x02
#define MAX72XX_D2      	0x03
#define MAX72XX_D3      	0x04
#define MAX72XX_D4      	0x05
#define MAX72XX_D5      	0x06
#define MAX72XX_D6      	0x07
#define MAX72XX_D7     		0x08
#define MAX72XX_DECMODE  	0x09
#define MAX72XX_INTENSITY	0x0a
#define MAX72XX_SCANLIMIT   0x0b
#define MAX72XX_SHUTDOWN    0x0c
#define MAX72XX_DISPTEST 	0x0f

struct Max72xxConfig {
	uint8 pinCS, pinCLK, pinDATA;
	uint8 maxDevices;

	/* We keep track of the led-status for all 8 devices in this array */
	uint8 buf[64];
};

const static uint8 max72xxFont[41][6] = { { 0x7E, 0x81, 0x81, 0x81, 0x7E, 0x0 }, //0
		{ 0x4, 0x82, 0xFF, 0x80, 0x0, 0x0 },  //1
		{ 0xE2, 0x91, 0x91, 0x91, 0x8E, 0x0 },  //2
		{ 0x42, 0x89, 0x89, 0x89, 0x76, 0x0 },  //3
		{ 0x1F, 0x10, 0x10, 0xFF, 0x10, 0x0 },  //4
		{ 0x8F, 0x89, 0x89, 0x89, 0x71, 0x0 },  //5
		{ 0x7E, 0x89, 0x89, 0x89, 0x71, 0x0 },  //6
		{ 0x1, 0x1, 0xF9, 0x5, 0x3, 0x0 },  //7
		{ 0x76, 0x89, 0x89, 0x89, 0x76, 0x0 },  //8
		{ 0x8E, 0x91, 0x91, 0x91, 0x7E, 0x0 },  //9
		{ 0x0, 0x0, 0x0, 0x0, 0x0, 0x0 },  // blank space
		{ 0x0, 0x0, 0x90, 0x0, 0x0, 0x0 }, //:
		{ 0x0, 0x10, 0x10, 0x10, 0x10, 0x0 }, // -
		{ 0x0, 0x0, 0x80, 0x0, 0x0, 0x0 }, // .
		{ 0xFC, 0x9, 0x11, 0x21, 0xFC, 0x0 }, //С
		{ 0xFE, 0x11, 0x11, 0x11, 0xFE, 0x0 }, //A
		{ 0xFF, 0x89, 0x89, 0x89, 0x76, 0x0 }, //B
		{ 0x7E, 0x81, 0x81, 0x81, 0x42, 0x0 }, //C
		{ 0xFF, 0x81, 0x81, 0x81, 0x7E, 0x0 }, //D
		{ 0xFF, 0x89, 0x89, 0x89, 0x81, 0x0 }, //E
		{ 0xFF, 0x9, 0x9, 0x9, 0x1, 0x0 }, //F
		{ 0x7E, 0x81, 0x81, 0x91, 0x72, 0x0 }, //G
		{ 0xFF, 0x8, 0x8, 0x8, 0xFF, 0x0 }, //H
		{ 0x0, 0x81, 0xFF, 0x81, 0x0, 0x0 }, //I
		{ 0x60, 0x80, 0x80, 0x80, 0x7F, 0x0 }, //J
		{ 0xFF, 0x18, 0x24, 0x42, 0x81, 0x0 }, //K
		{ 0xFF, 0x80, 0x80, 0x80, 0x80, 0x0 }, //L
		{ 0xFF, 0x2, 0x4, 0x2, 0xFF, 0x0 }, //M
		{ 0xFF, 0x2, 0x4, 0x8, 0xFF, 0x0 }, //N
		{ 0x7E, 0x81, 0x81, 0x81, 0x7E, 0x0 }, //O
		{ 0xFF, 0x11, 0x11, 0x11, 0xE, 0x0 }, //P
		{ 0x7E, 0x81, 0x81, 0xA1, 0x7E, 0x80 }, //Q
		{ 0xFF, 0x11, 0x31, 0x51, 0x8E, 0x0 }, //R
		{ 0x46, 0x89, 0x89, 0x89, 0x72, 0x0 }, //S
		{ 0x1, 0x1, 0xFF, 0x1, 0x1, 0x0 }, //T
		{ 0x7F, 0x80, 0x80, 0x80, 0x7F, 0x0 }, //U
		{ 0x3F, 0x40, 0x80, 0x40, 0x3F, 0x0 }, //V
		{ 0x7F, 0x80, 0x60, 0x80, 0x7F, 0x0 }, //W
		{ 0xE3, 0x14, 0x8, 0x14, 0xE3, 0x0 }, //X
		{ 0x3, 0x4, 0xF8, 0x4, 0x3, 0x0 }, //Y
		{ 0xE1, 0x91, 0x89, 0x85, 0x83, 0x0 } //Z
};

struct Max72xxConfig max72xx_configure(int dataPin, int clkPin, int csPin,
		int numDevices);

void max72xx_init(struct Max72xxConfig cfg);
void max72xx_setIntensity(struct Max72xxConfig cfg, uint8 intensity);

void max72xx_clear(struct Max72xxConfig cfg);
void max72xx_setDot(struct Max72xxConfig cfg, uint8 col, uint8 row,
		uint8 value);
void max72xx_refresh(struct Max72xxConfig cfg);

void max72xx_showChar(struct Max72xxConfig cfg, int matrix, int charIndex);

void max72xx_setColumn(struct Max72xxConfig cfg, uint8 col, uint8 value);
void max72xx_setColumnAll(struct Max72xxConfig cfg, uint8 col, uint8 value);
#endif /* INCLUDE_DRIVER_MAX72XX_H_ */
